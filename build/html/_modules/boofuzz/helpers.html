<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>boofuzz.helpers &mdash; rainfuzz 0.0 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=16727793"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/translations.js?v=beaddf03"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            rainfuzz
          </a>
              <div class="version">
                0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/install.html">Installing boofuzz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/contributing.html">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/connections.html">Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/monitors.html">Monitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/protocol-definition.html">Protocol Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/static-protocol-definition.html">Static Protocol Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/other-modules.html">Other Modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rainfuzz</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">模块代码</a></li>
          <li class="breadcrumb-item"><a href="../boofuzz.html">boofuzz</a></li>
      <li class="breadcrumb-item active">boofuzz.helpers</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>boofuzz.helpers 源代码</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">int</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

<span class="kn">from</span> <span class="nn">colorama</span> <span class="kn">import</span> <span class="n">Back</span><span class="p">,</span> <span class="n">Fore</span><span class="p">,</span> <span class="n">Style</span>

<span class="kn">from</span> <span class="nn">boofuzz.connections</span> <span class="kn">import</span> <span class="n">ip_constants</span><span class="p">,</span> <span class="n">udp_socket_connection</span>
<span class="kn">from</span> <span class="nn">boofuzz.exception</span> <span class="kn">import</span> <span class="n">BoofuzzError</span>

<span class="c1"># Curses color pairs</span>

<span class="n">COLOR_PAIR_WHITE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">COLOR_PAIR_CYAN</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">COLOR_PAIR_RED</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">COLOR_PAIR_YELLOW</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">COLOR_PAIR_GREEN</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">COLOR_PAIR_MAGENTA</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">COLOR_PAIR_BLACK</span> <span class="o">=</span> <span class="mi">7</span>

<span class="n">test_step_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;test_case&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Test Case&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Test Case: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="n">Fore</span><span class="o">.</span><span class="n">YELLOW</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span> <span class="o">+</span> <span class="s2">&quot;Test Case: </span><span class="si">{msg}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-case&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_YELLOW</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Test Step&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot; Test Step: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span> <span class="o">+</span> <span class="s2">&quot;Test Step: </span><span class="si">{msg}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-step&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_MAGENTA</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Info&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Info: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="s2">&quot;Info: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-info&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_WHITE</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Error!!!! </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="n">Back</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span> <span class="o">+</span> <span class="s2">&quot;Error!!!! </span><span class="si">{msg}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_RED</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;send&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Transmitted&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Transmitted </span><span class="si">{n}</span><span class="s2"> bytes</span><span class="si">{note}</span><span class="s2">: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span> <span class="o">+</span> <span class="s2">&quot;Transmitted </span><span class="si">{n}</span><span class="s2"> bytes</span><span class="si">{note}</span><span class="s2">: </span><span class="si">{msg}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-send&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_CYAN</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;receive&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Received&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Received</span><span class="si">{note}</span><span class="s2">: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span> <span class="o">+</span> <span class="s2">&quot;Received</span><span class="si">{note}</span><span class="s2">: </span><span class="si">{msg}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-receive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_CYAN</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;check&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Check&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Check: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="s2">&quot;Check: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-check&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_WHITE</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;fail&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Check Failed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Check Failed: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span> <span class="o">+</span> <span class="s2">&quot;Check Failed: </span><span class="si">{msg}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-fail&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_RED</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;pass&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Check OK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="s2">&quot;Check OK: </span><span class="si">{msg}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;terminal&quot;</span><span class="p">:</span> <span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">BRIGHT</span> <span class="o">+</span> <span class="s2">&quot;Check OK: </span><span class="si">{msg}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">Style</span><span class="o">.</span><span class="n">RESET_ALL</span><span class="p">,</span>
        <span class="s2">&quot;css_class&quot;</span><span class="p">:</span> <span class="s2">&quot;log-pass&quot;</span><span class="p">,</span>
        <span class="s2">&quot;curses&quot;</span><span class="p">:</span> <span class="n">COLOR_PAIR_GREEN</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>


<div class="viewcode-block" id="ip_str_to_bytes"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.ip_str_to_bytes">[文档]</a><span class="k">def</span> <span class="nf">ip_str_to_bytes</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert an IP string to a four-byte bytes.</span>

<span class="sd">    :param ip: IP address string, e.g. &#39;127.0.0.1&#39;</span>

<span class="sd">    :return 4-byte representation of ip, e.g. b&#39;\x7F\x00\x00\x01&#39;</span>
<span class="sd">    :rtype bytes</span>

<span class="sd">    :raises ValueError if ip is not a legal IP address.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Illegal IP address passed to socket.inet_aton: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_max_udp_size"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.get_max_udp_size">[文档]</a><span class="k">def</span> <span class="nf">get_max_udp_size</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crazy CTypes magic to do a getsockopt() which determines the max UDP payload size in a platform-agnostic way.</span>

<span class="sd">    .. deprecated:: 0.2.0</span>
<span class="sd">        Use :meth:`UDPSocketConnection.max_payload() &lt;boofuzz.connections.UDPSocketConnection.max_payload&gt;` instead.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The maximum length of a UDP packet the current platform supports</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;get_max_udp_size() is deprecated and will be removed in a future version of boofuzz. &quot;</span>
        <span class="s2">&quot;Use UDPSocketConnection.max_payload() instead.&quot;</span><span class="p">,</span>
        <span class="ne">FutureWarning</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">udp_socket_connection</span><span class="o">.</span><span class="n">UDPSocketConnection</span><span class="o">.</span><span class="n">max_payload</span><span class="p">()</span></div>


<div class="viewcode-block" id="calculate_four_byte_padding"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.calculate_four_byte_padding">[文档]</a><span class="k">def</span> <span class="nf">calculate_four_byte_padding</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">character</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="crc16"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.crc16">[文档]</a><span class="k">def</span> <span class="nf">crc16</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;CRC-16 poly: p(x) = x**16 + x**15 + x**2 + 1</span>

<span class="sd">    @param string: Data over which to calculate crc.</span>
<span class="sd">    @param value: Initial CRC value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">crc16_table</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">crc</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">byte</span> <span class="o">^</span> <span class="n">crc</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">crc</span> <span class="o">=</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="mh">0xA001</span>  <span class="c1"># polly</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">crc</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>

            <span class="n">byte</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>

        <span class="n">crc16_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">crc</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">crc16_table</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)]</span> <span class="o">^</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="crc32"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.crc32">[文档]</a><span class="k">def</span> <span class="nf">crc32</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">zlib</span><span class="o">.</span><span class="n">crc32</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span></div>


<div class="viewcode-block" id="uuid_bin_to_str"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.uuid_bin_to_str">[文档]</a><span class="k">def</span> <span class="nf">uuid_bin_to_str</span><span class="p">(</span><span class="n">uuid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a binary UUID to human readable string.</span>

<span class="sd">    @param uuid: bytes representing UUID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">block1</span><span class="p">,</span> <span class="n">block2</span><span class="p">,</span> <span class="n">block3</span><span class="p">)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;LHH&quot;</span><span class="p">,</span> <span class="n">uuid</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
    <span class="p">(</span><span class="n">block4</span><span class="p">,</span> <span class="n">block5</span><span class="p">,</span> <span class="n">block6</span><span class="p">)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;HHL&quot;</span><span class="p">,</span> <span class="n">uuid</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%08x</span><span class="s2">-</span><span class="si">%04x</span><span class="s2">-</span><span class="si">%04x</span><span class="s2">-</span><span class="si">%04x</span><span class="s2">-</span><span class="si">%04x%08x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">block1</span><span class="p">,</span> <span class="n">block2</span><span class="p">,</span> <span class="n">block3</span><span class="p">,</span> <span class="n">block4</span><span class="p">,</span> <span class="n">block5</span><span class="p">,</span> <span class="n">block6</span><span class="p">)</span></div>


<div class="viewcode-block" id="uuid_str_to_bin"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.uuid_str_to_bin">[文档]</a><span class="k">def</span> <span class="nf">uuid_str_to_bin</span><span class="p">(</span><span class="n">uuid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a UUID string to binary form.</span>

<span class="sd">    Expected string input format is same as uuid_bin_to_str()&#39;s output format.</span>

<span class="sd">    Ripped from Core Impacket.</span>

<span class="sd">    :param uuid: UUID string to convert to bytes.</span>
<span class="sd">    :type uuid: str</span>
<span class="sd">    :return: UUID as bytes.</span>
<span class="sd">    :rtype: bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">uuid_re</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;([\dA-Fa-f]</span><span class="si">{8}</span><span class="s2">)-([\dA-Fa-f]</span><span class="si">{4}</span><span class="s2">)-([\dA-Fa-f]</span><span class="si">{4}</span><span class="s2">)-([\dA-Fa-f]</span><span class="si">{4}</span><span class="s2">)-([\dA-Fa-f]</span><span class="si">{4}</span><span class="s2">)([\dA-Fa-f]</span><span class="si">{8}</span><span class="s2">)&quot;</span>

    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">uuid_re</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span>

    <span class="c1"># pytype: disable=attribute-error</span>
    <span class="p">(</span><span class="n">uuid1</span><span class="p">,</span> <span class="n">uuid2</span><span class="p">,</span> <span class="n">uuid3</span><span class="p">,</span> <span class="n">uuid4</span><span class="p">,</span> <span class="n">uuid5</span><span class="p">,</span> <span class="n">uuid6</span><span class="p">)</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
    <span class="c1"># pytype: enable=attribute-error</span>

    <span class="n">uuid</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;LHH&quot;</span><span class="p">,</span> <span class="n">uuid1</span><span class="p">,</span> <span class="n">uuid2</span><span class="p">,</span> <span class="n">uuid3</span><span class="p">)</span>
    <span class="n">uuid</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;HHL&quot;</span><span class="p">,</span> <span class="n">uuid4</span><span class="p">,</span> <span class="n">uuid5</span><span class="p">,</span> <span class="n">uuid6</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">uuid</span></div>


<span class="k">def</span> <span class="nf">_ones_complement_sum_carry_16</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute ones complement sum and carry at 16 bits.</span>

<span class="sd">    :type a: int</span>
<span class="sd">    :type b: int</span>

<span class="sd">    :return: Sum of a and b, ones complement, carry at 16 bits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pre_sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">pre_sum</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">pre_sum</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_collate_bytes</span><span class="p">(</span><span class="n">msb</span><span class="p">,</span> <span class="n">lsb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for our helper functions.</span>
<span class="sd">    Collates msb and lsb into one 16-bit value.</span>

<span class="sd">    :type msb: byte</span>
<span class="sd">    :param msb: Single byte (most significant).</span>

<span class="sd">    :type lsb: byte</span>
<span class="sd">    :param lsb: Single byte (least significant).</span>

<span class="sd">    :return: msb and lsb all together in one 16 bit value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">msb</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">lsb</span>


<div class="viewcode-block" id="ipv4_checksum"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.ipv4_checksum">[文档]</a><span class="k">def</span> <span class="nf">ipv4_checksum</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return IPv4 checksum of msg.</span>
<span class="sd">    :param msg: Message to compute checksum over.</span>
<span class="sd">    :type msg: bytes</span>

<span class="sd">    :return: IPv4 checksum of msg.</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pad with 0 byte if needed</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

    <span class="n">msg_words</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">_collate_bytes</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_ones_complement_sum_carry_16</span><span class="p">,</span> <span class="n">msg_words</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">~</span><span class="n">total</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span></div>


<span class="k">def</span> <span class="nf">_udp_checksum_pseudo_header</span><span class="p">(</span><span class="n">src_addr</span><span class="p">,</span> <span class="n">dst_addr</span><span class="p">,</span> <span class="n">msg_len</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return pseudo-header for UDP checksum.</span>

<span class="sd">    :type src_addr: bytes</span>
<span class="sd">    :param src_addr: Source IP address -- 4 bytes.</span>

<span class="sd">    :type dst_addr: bytes</span>
<span class="sd">    :param dst_addr: Destination IP address -- 4 bytes.</span>

<span class="sd">    :param msg_len: Length of UDP message (not including IPv4 header).</span>
<span class="sd">    :type msg_len: int</span>

<span class="sd">    :return: UDP pseudo-header</span>
<span class="sd">    :rtype: bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">src_addr</span> <span class="o">+</span> <span class="n">dst_addr</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">ip_constants</span><span class="o">.</span><span class="n">IPV4_PROTOCOL_UDP</span><span class="p">])</span> <span class="o">+</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;H&quot;</span><span class="p">,</span> <span class="n">msg_len</span><span class="p">)</span>


<div class="viewcode-block" id="udp_checksum"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.udp_checksum">[文档]</a><span class="k">def</span> <span class="nf">udp_checksum</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">src_addr</span><span class="p">,</span> <span class="n">dst_addr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return UDP checksum of msg.</span>

<span class="sd">    Recall that the UDP checksum involves creating a sort of pseudo IP header.</span>
<span class="sd">    This header requires the source and destination IP addresses, which this</span>
<span class="sd">    function takes as parameters.</span>

<span class="sd">    If msg is too big, the checksum is undefined, and this method will</span>
<span class="sd">    truncate it for the sake of checksum calculation. Note that this means the</span>
<span class="sd">    checksum will be invalid. This loosey goosey error checking is done to</span>
<span class="sd">    support fuzz tests which at times generate huge, invalid packets.</span>


<span class="sd">    :param msg: Message to compute checksum over.</span>
<span class="sd">    :type msg: bytes</span>

<span class="sd">    :type src_addr: bytes</span>
<span class="sd">    :param src_addr: Source IP address -- 4 bytes.</span>
<span class="sd">    :type dst_addr: bytes</span>
<span class="sd">    :param dst_addr: Destination IP address -- 4 bytes.</span>

<span class="sd">    :return: UDP checksum of msg.</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the packet is too big, the checksum is undefined since len(msg)</span>
    <span class="c1"># won&#39;t fit into two bytes. So we just pick our best definition.</span>
    <span class="c1"># &quot;Truncate&quot; the message as it appears in the checksum.</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">ip_constants</span><span class="o">.</span><span class="n">UDP_MAX_LENGTH_THEORETICAL</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">ipv4_checksum</span><span class="p">(</span><span class="n">_udp_checksum_pseudo_header</span><span class="p">(</span><span class="n">src_addr</span><span class="p">,</span> <span class="n">dst_addr</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span> <span class="o">+</span> <span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="hex_str"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.hex_str">[文档]</a><span class="k">def</span> <span class="nf">hex_str</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a hex-formatted string based on s.</span>

<span class="sd">    Args:</span>
<span class="sd">        s (bytes): Some string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Hex-formatted string representing s.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:02x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">s</span><span class="p">))</span></div>


<div class="viewcode-block" id="pause_for_signal"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.pause_for_signal">[文档]</a><span class="k">def</span> <span class="nf">pause_for_signal</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pauses the current thread in a way that can still receive signals like SIGINT from Ctrl+C.</span>

<span class="sd">    Implementation notes:</span>
<span class="sd">     - Linux uses signal.pause()</span>
<span class="sd">     - Windows uses a loop that sleeps for 1 ms at a time, allowing signals</span>
<span class="sd">       to interrupt the thread fairly quickly.</span>

<span class="sd">    :return: None</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c1"># signal.pause() is missing for Windows; wait 1ms and loop instead</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_time_stamp"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.get_time_stamp">[文档]</a><span class="k">def</span> <span class="nf">get_time_stamp</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;[%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;,</span><span class="si">%03d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span></div>


<span class="k">def</span> <span class="nf">_indent_all_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="n">ch</span>
    <span class="k">return</span> <span class="n">padding</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_indent_after_first_line</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="n">ch</span>
    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>


<div class="viewcode-block" id="format_log_msg"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.format_log_msg">[文档]</a><span class="k">def</span> <span class="nf">format_log_msg</span><span class="p">(</span>
    <span class="n">msg_type</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">indent_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">truncated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">format_type</span><span class="o">=</span><span class="s2">&quot;terminal&quot;</span>
<span class="p">):</span>
    <span class="n">curses_mode</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">get_time_stamp</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">format_type</span> <span class="o">==</span> <span class="s2">&quot;curses&quot;</span><span class="p">:</span>
        <span class="n">curses_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">format_type</span> <span class="o">=</span> <span class="s2">&quot;html&quot;</span>

    <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">description</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">description</span>
    <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">hex_to_hexstr</span><span class="p">(</span><span class="n">input_bytes</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">test_step_info</span><span class="p">[</span><span class="n">msg_type</span><span class="p">][</span><span class="n">format_type</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># pytype: disable=attribute-error</span>
        <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">note</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">truncated</span> <span class="k">else</span> <span class="s2">&quot; (data truncated for database storage)&quot;</span>
    <span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">_indent_all_lines</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">(</span><span class="n">test_step_info</span><span class="p">[</span><span class="n">msg_type</span><span class="p">][</span><span class="s2">&quot;indent&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">indent_size</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">_indent_after_first_line</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">curses_mode</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">msg</span><span class="p">,</span> <span class="n">test_step_info</span><span class="p">[</span><span class="n">msg_type</span><span class="p">][</span><span class="s2">&quot;curses&quot;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">msg</span></div>


<div class="viewcode-block" id="format_msg"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.format_msg">[文档]</a><span class="k">def</span> <span class="nf">format_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">indent_level</span><span class="p">,</span> <span class="n">indent_size</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">_indent_all_lines</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">indent_level</span> <span class="o">*</span> <span class="n">indent_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">get_time_stamp</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">_indent_after_first_line</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="hex_to_hexstr"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.hex_to_hexstr">[文档]</a><span class="k">def</span> <span class="nf">hex_to_hexstr</span><span class="p">(</span><span class="n">input_bytes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render input_bytes as ASCII-encoded hex bytes, followed by a best effort</span>
<span class="sd">    utf-8 rendering.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_bytes (bytes): Arbitrary bytes</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Printable string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hex_str</span><span class="p">(</span><span class="n">input_bytes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">input_bytes</span><span class="p">)</span></div>


<div class="viewcode-block" id="mkdir_safe"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.mkdir_safe">[文档]</a><span class="k">def</span> <span class="nf">mkdir_safe</span><span class="p">(</span><span class="n">directory_name</span><span class="p">,</span> <span class="n">file_included</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates directory_name and subdirectories. If file_included is true, removes final element of the path&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_included</span><span class="p">:</span>
        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory_name</span><span class="p">)</span>
        <span class="n">directory_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span>
            <span class="k">raise</span></div>


<div class="viewcode-block" id="path_exists"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.path_exists">[文档]</a><span class="k">def</span> <span class="nf">path_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;To avoid polluting files with import os&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_boofuzz_version"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.get_boofuzz_version">[文档]</a><span class="k">def</span> <span class="nf">get_boofuzz_version</span><span class="p">(</span><span class="n">boofuzz_class</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses __init__.py for a version string and returns it like &#39;v0.0.0&#39;</span>

<span class="sd">    :type  boofuzz_class: class</span>
<span class="sd">    :param boofuzz_class: Any boofuzz class in the same dir as the __init__ class.</span>

<span class="sd">    :rtype: str</span>
<span class="sd">    :return: Boofuzz version as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">boofuzz_class</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;__init__.py&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">search</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">search</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;__version__ = &quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;v&quot;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;(.*?)&quot;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># pytype: disable=attribute-error</span>
    <span class="k">return</span> <span class="s2">&quot;v-.-.-&quot;</span></div>


<div class="viewcode-block" id="str_to_bytes"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.str_to_bytes">[文档]</a><span class="k">def</span> <span class="nf">str_to_bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_target"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.parse_target">[文档]</a><span class="k">def</span> <span class="nf">parse_target</span><span class="p">(</span><span class="n">target_name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">host</span><span class="p">,</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">target_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Target format is HOST:PORT&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_test_case_name"><a class="viewcode-back" href="../../user/other-modules.html#boofuzz.helpers.parse_test_case_name">[文档]</a><span class="k">def</span> <span class="nf">parse_test_case_name</span><span class="p">(</span><span class="n">test_case</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a test case name into a message path and a list of mutation names.</span>

<span class="sd">    Example:</span>
<span class="sd">        Input: &quot;message1:[message1.first_byte:2, message1.second_byte:1, message1.third_byte:2]&quot;</span>
<span class="sd">        Output: [&quot;message1&quot;], [&quot;message1.first_byte:2&quot;, &quot;message1.second_byte:1&quot;, &quot;message1.third_byte:2&quot;]</span>

<span class="sd">    Returns:</span>
<span class="sd">        A message path (list of message names) and a list of mutation names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">components</span> <span class="o">=</span> <span class="n">test_case</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">message_path</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">message_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mutations</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[(.*)\]&quot;</span><span class="p">,</span> <span class="n">mutations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BoofuzzError</span><span class="p">(</span><span class="s2">&quot;could not parse test case name: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_case</span><span class="p">))</span>
        <span class="n">mutations</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mutations</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,\s*&quot;</span><span class="p">,</span> <span class="n">mutations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutations</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 boofuzz。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>