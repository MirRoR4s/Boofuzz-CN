<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>boofuzz.sessions &mdash; boofuzz 0.4.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon-32x32.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=ea00750a"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="icon" type="image/svg+xml" href="../../_static/favicon.svg" sizes="any">
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/boo-logo-light.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.4.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">用户指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/install.html">安装 boofuzz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/quickstart.html">快速开始</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/contributing.html">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API 文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/Session.html">Session</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/Target.html">Target</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/connections.html">Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/monitors.html">Monitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/protocol-definition.html">Protocol Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/static-protocol-definition.html">Static Protocol Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/other-modules.html">Other Modules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">boofuzz</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../boofuzz.html">boofuzz</a></li>
      <li class="breadcrumb-item active">boofuzz.sessions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for boofuzz.sessions</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="nb">open</span>

<span class="kn">from</span> <span class="nn">tornado.httpserver</span> <span class="kn">import</span> <span class="n">HTTPServer</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
<span class="kn">from</span> <span class="nn">tornado.wsgi</span> <span class="kn">import</span> <span class="n">WSGIContainer</span>

<span class="kn">from</span> <span class="nn">boofuzz</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">blocks</span><span class="p">,</span>
    <span class="n">constants</span><span class="p">,</span>
    <span class="n">event_hook</span><span class="p">,</span>
    <span class="n">exception</span><span class="p">,</span>
    <span class="n">fuzz_logger</span><span class="p">,</span>
    <span class="n">fuzz_logger_curses</span><span class="p">,</span>
    <span class="n">fuzz_logger_db</span><span class="p">,</span>
    <span class="n">fuzz_logger_text</span><span class="p">,</span>
    <span class="n">helpers</span><span class="p">,</span>
    <span class="n">pgraph</span><span class="p">,</span>
    <span class="n">primitives</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">boofuzz.monitors</span> <span class="kn">import</span> <span class="n">CallbackMonitor</span>
<span class="kn">from</span> <span class="nn">boofuzz.mutation_context</span> <span class="kn">import</span> <span class="n">MutationContext</span>
<span class="kn">from</span> <span class="nn">boofuzz.protocol_session</span> <span class="kn">import</span> <span class="n">ProtocolSession</span>
<span class="kn">from</span> <span class="nn">boofuzz.web.app</span> <span class="kn">import</span> <span class="n">app</span>
<span class="kn">from</span> <span class="nn">.exception</span> <span class="kn">import</span> <span class="n">BoofuzzFailure</span>


<div class="viewcode-block" id="Target"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target">[docs]</a><span class="k">class</span> <span class="nc">Target</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Target descriptor container.</span>

<span class="sd">    Takes an ITargetConnection and wraps send/recv with appropriate</span>
<span class="sd">    FuzzDataLogger calls.</span>

<span class="sd">    Encapsulates pedrpc connection logic.</span>

<span class="sd">    Contains a logger which is configured by Session.add_target().</span>

<span class="sd">    Example:</span>
<span class="sd">        tcp_target = Target(SocketConnection(host=&#39;127.0.0.1&#39;, port=17971))</span>

<span class="sd">    Args:</span>
<span class="sd">        connection (itarget_connection.ITargetConnection): 到目标系统的连接对象</span>
<span class="sd">        monitors (List[Union[IMonitor, pedrpc.Client]]): 当前 Target 对象的监视器列表。</span>
<span class="sd">        monitor_alive: 当监视器处于活跃状态时会调用的一个函数列表</span>
<span class="sd">        repeater (repeater.Repeater): 发送时所用的 Repeater，默认为 None</span>
<span class="sd">        procmon: 用于添加进程监视器的接口（已弃用）</span>
<span class="sd">        procmon_options: 同上</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">connection</span><span class="p">,</span>
        <span class="n">monitors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">monitor_alive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_recv_bytes</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
        <span class="n">repeater</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">procmon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">procmon_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># 模糊测试数据记录器</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_target_connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_recv_bytes</span> <span class="o">=</span> <span class="n">max_recv_bytes</span> <span class="c1"># 最大接收字节数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repeater</span> <span class="o">=</span> <span class="n">repeater</span> <span class="c1"># repeater 是什么？或许类似于 Burp Repeater</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitors</span> <span class="o">=</span> <span class="n">monitors</span> <span class="k">if</span> <span class="n">monitors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">procmon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">procmon_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">procmon</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="o">**</span><span class="n">procmon_options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">procmon</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_alive</span> <span class="o">=</span> <span class="n">monitor_alive</span> <span class="k">if</span> <span class="n">monitor_alive</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s2">&quot;procmon&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;procmon&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Target(procmon=...) is deprecated. Please change your code&quot;</span>
                <span class="s2">&quot; and add it to the monitors argument. For now, we do this &quot;</span>
                <span class="s2">&quot;for you, but this will be removed in the future.&quot;</span><span class="p">,</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;procmon&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">&quot;netmon&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;netmon&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Target(netmon=...) is deprecated. Please change your code&quot;</span>
                <span class="s2">&quot; and add it to the monitors argument. For now, we do this &quot;</span>
                <span class="s2">&quot;for you, but this will be removed in the future.&quot;</span><span class="p">,</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;netmon&quot;</span><span class="p">])</span>

        <span class="c1"># set these manually once target is instantiated.</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;vmcontrol 应该和目标的重启有关，如果 vmcontrol 可用，那</span>
<span class="sd">        # 么就会恢复虚拟机快照。这个选项可能是在说明目标是运行在虚拟机中的。</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vmcontrol</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">vmcontrol_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">netmon_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This property is not supported; grab netmon from monitors and use set_options(**dict)&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">procmon_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This property is not supported; grab procmon from monitors and use set_options(**dict)&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Target.close"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close connection to the target.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Closing target connection...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Connection closed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Target.open"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens connection to the target. Make sure to call close!</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Opening target connection (</span><span class="si">{0}</span><span class="s2">)...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_target_connection</span><span class="o">.</span><span class="n">info</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_connection</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Connection opened.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Target.pedrpc_connect"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target.pedrpc_connect">[docs]</a>    <span class="k">def</span> <span class="nf">pedrpc_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;pedrpc_connect has been renamed to monitors_alive. &quot;</span>
            <span class="s2">&quot;This alias will stop working in a future version of boofuzz.&quot;</span><span class="p">,</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitors_alive</span><span class="p">()</span></div>

<div class="viewcode-block" id="Target.monitors_alive"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target.monitors_alive">[docs]</a>    <span class="k">def</span> <span class="nf">monitors_alive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        等待监视器启动（活跃）/与 RPC 服务器建立连接。</span>
<span class="sd">        当某个 target 被添加到 session 中时，target 的每一次重启都会调用该方法。</span>
<span class="sd">        在成功 probing 后，会调用一个回调函数，并将 monitor 传进去。</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">monitor</span><span class="o">.</span><span class="n">alive</span><span class="p">():</span>
                    <span class="k">break</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_alive</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_alive</span><span class="p">:</span>
                    <span class="n">cb</span><span class="p">(</span><span class="n">monitor</span><span class="p">)</span></div>

<div class="viewcode-block" id="Target.recv"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target.recv">[docs]</a>    <span class="k">def</span> <span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Receive up to max_bytes data from the target.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_bytes (int): Maximum number of bytes to receive.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Received data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_recv_bytes</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Receiving...&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">max_bytes</span><span class="o">=</span><span class="n">max_bytes</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_recv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Target.send"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send data to the target. Only valid after calling open!</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Data to send.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_sent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">repeat</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeater</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">repeat</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeater</span><span class="o">.</span><span class="n">log_message</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Sending </span><span class="si">{0}</span><span class="s2"> bytes</span><span class="si">{1}</span><span class="s2">...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">repeat</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeater</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repeater</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeater</span><span class="o">.</span><span class="n">repeat</span><span class="p">():</span>
                <span class="n">num_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repeater</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_send</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">num_sent</span><span class="p">])</span></div>

<div class="viewcode-block" id="Target.set_fuzz_data_logger"><a class="viewcode-back" href="../../source/Target.html#boofuzz.Target.set_fuzz_data_logger">[docs]</a>    <span class="k">def</span> <span class="nf">set_fuzz_data_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fuzz_data_logger</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        设置当前 Target 对象的 fuzz 数据记录器--用于发送和接收 fuzz 数据。</span>

<span class="sd">        :param fuzz_data_logger: New logger.</span>
<span class="sd">        :type fuzz_data_logger: ifuzz_logger.IFuzzLogger</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span> <span class="o">=</span> <span class="n">fuzz_data_logger</span></div></div>


<span class="k">class</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">pgraph</span><span class="o">.</span><span class="n">Edge</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extends pgraph.edge with a callback option. This allows us to register a function to call between node</span>
<span class="sd">        transmissions to implement functionality such as challenge response systems. The callback method must follow</span>
<span class="sd">        this prototype::</span>

<span class="sd">            def callback(target, fuzz_data_logger, session, node, edge, *args, **kwargs)</span>

<span class="sd">        Where node is the node about to be sent, edge is the last edge along the current fuzz path to &quot;node&quot;, session</span>
<span class="sd">        is a pointer to the session instance which is useful for snagging data such as sesson.last_recv which contains</span>
<span class="sd">        the data returned from the last socket transmission and sock is the live socket. A callback is also useful in</span>
<span class="sd">        situations where, for example, the size of the next packet is specified in the first packet.</span>

<span class="sd">        Args:</span>
<span class="sd">            src (int): Edge source ID</span>
<span class="sd">            dst (int): Edge destination ID</span>
<span class="sd">            callback (function): Optional. Callback function to pass received data to between node xmits</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Connection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>


<span class="k">class</span> <span class="nc">SessionInfo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_reader</span> <span class="o">=</span> <span class="n">fuzz_logger_db</span><span class="o">.</span><span class="n">FuzzLoggerDbReader</span><span class="p">(</span><span class="n">db_filename</span><span class="o">=</span><span class="n">db_filename</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">monitor_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_reader</span><span class="o">.</span><span class="n">failure_map</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">monitor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Monitor Data is not currently saved in the database&quot;</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">procmon_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;procmon_results has been renamed to monitor_results.&quot;</span>
            <span class="s2">&quot;This alias will stop working in a future version of boofuzz&quot;</span><span class="p">,</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_results</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">netmon_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;netmon_results is now part of monitor_data&quot;</span> <span class="s2">&quot;This alias will stop working in a future version of boofuzz&quot;</span><span class="p">,</span>
            <span class="ne">FutureWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fuzz_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_num_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_mutant_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_reader</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) FROM cases&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mutant_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">test_case_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return test case data object (for use by web server)</span>

<span class="sd">        Args:</span>
<span class="sd">            index (int): Test case index</span>

<span class="sd">        Returns:</span>
<span class="sd">            Test case data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_reader</span><span class="o">.</span><span class="n">get_test_case_data</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_paused</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;finished&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exec_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_test_case_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>


<span class="k">class</span> <span class="nc">WebApp</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serve fuzz data over HTTP.</span>

<span class="sd">    Args:</span>
<span class="sd">        session_info (SessionInfo): Object providing information on session</span>
<span class="sd">        web_port (int):         Port for monitoring fuzzing campaign via a web browser. Default 26000.</span>
<span class="sd">        web_address (string):   Address binded to port for monitoring fuzzing campaign via a web browser.</span>
<span class="sd">                                Default &#39;localhost&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session_info</span><span class="p">,</span> <span class="n">web_port</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_PORT</span><span class="p">,</span> <span class="n">web_address</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_ADDRESS</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_info</span> <span class="o">=</span> <span class="n">session_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_web_interface_thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_webapp_thread</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">web_port</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">web_address</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_build_webapp_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_info</span>
        <span class="n">http_server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">WSGIContainer</span><span class="p">(</span><span class="n">app</span><span class="p">))</span>
        <span class="n">http_server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">)</span>
        <span class="n">flask_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="n">flask_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">flask_thread</span>

    <span class="k">def</span> <span class="nf">server_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called by fuzz() to initialize variables, web interface, etc.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_web_interface_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="c1"># spawn the web interface.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_web_interface_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">open_test_run</span><span class="p">(</span><span class="n">db_filename</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_PORT</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_ADDRESS</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">SessionInfo</span><span class="p">(</span><span class="n">db_filename</span><span class="o">=</span><span class="n">db_filename</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">WebApp</span><span class="p">(</span><span class="n">session_info</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">web_port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">web_address</span><span class="o">=</span><span class="n">address</span><span class="p">)</span>
    <span class="n">w</span><span class="o">.</span><span class="n">server_init</span><span class="p">()</span>


<div class="viewcode-block" id="Session"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session">[docs]</a><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">pgraph</span><span class="o">.</span><span class="n">Graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;继承自 pgraph.graph，为协议对话的构造提供了一个容器。</span>

<span class="sd">    Args:</span>
<span class="sd">        session_filename (str): 存放序列化数据的文件名，默认为 None</span>
<span class="sd">        index_start (int);      要运行的第一个测试用例的索引</span>
<span class="sd">        index_end (int);        要运行的最后一个测试用例的索引</span>
<span class="sd">        sleep_time (float):     测试用例之间等待的秒数，默认为 0</span>
<span class="sd">        restart_interval (int): 在 n 个测试用例之后重启目标。默认情况下为0，表示禁用该选项</span>
<span class="sd">        console_gui (bool):     是否使用 curses 在 web 端生成一个静态控制台，默认为 False（还未在 Windows 下进行测试）</span>
<span class="sd">        crash_threshold_request (int):  请求耗尽之前允许的最大崩溃次数，默认为 12。</span>
<span class="sd">        crash_threshold_element (int):  元素耗尽之前允许的最大崩溃次数，默认为 3</span>
<span class="sd">        restart_sleep_time (int): 当目标无法重启时等待的秒数，默认为5</span>
<span class="sd">        restart_callbacks (list of method): 在 `post_test_case_callback` 失败后调用的回调方法列表，默认为 None</span>
<span class="sd">        restart_threshold (int):    丢失目标连接时的最大重试次数，默认为 None（无限次）</span>
<span class="sd">        restart_timeout (float):    重新连接尝试的超时时间（秒），默认为 None（无限次）</span>
<span class="sd">        pre_send_callbacks (list of method): 在每个模糊（测试）请求之前调用的注册方法列表，默认为 None</span>
<span class="sd">        post_test_case_callbacks (list of method): 在每个模糊测试用例之后调用的注册方法列表，默认为None</span>
<span class="sd">        post_start_target_callbacks (list of method): 目标启动或重新启动后进程监视器调用的方法，默认为 None 。</span>
<span class="sd">        web_port (int or None): 通过 Web 浏览器监视模糊测试活动的端口。设置为 None 表示禁用 Web 应用程序，默认为 26000</span>
<span class="sd">        keep_web_open (bool): 在会话完成后保持 Web 界面打开，默认为 True</span>
<span class="sd">        fuzz_loggers (list of ifuzz_logger.IFuzzLogger): 日志记录器列表，用于保存测试数据和结果。默认将日志记录到 STDOUT 。</span>
<span class="sd">        fuzz_db_keep_only_n_pass_cases (int): Minimize disk usage by only saving passing test cases</span>
<span class="sd">                                              if they are in the n test cases preceding a failure or error.</span>
<span class="sd">                                              Set to 0 to save after every test case (high disk I/O!). Default 0.</span>
<span class="sd">        receive_data_after_each_request (bool): 如果为 True，在传输每个不进行模糊测试的节点后尝试接收回复，默认为True。</span>
<span class="sd">        check_data_received_each_request (bool): If True, Session will verify that some data has</span>
<span class="sd">                                                 been received after transmitting each non-fuzzed node, and if not,</span>
<span class="sd">                                                 register a failure. If False, this check will not be performed. Default</span>
<span class="sd">                                                 False. A receive attempt is still made unless</span>
<span class="sd">                                                 receive_data_after_each_request is False.</span>
<span class="sd">        receive_data_after_fuzz (bool): 如果该变量为真，那么在传输完一个 fuzzed 消息后，Session 会尝试接收一个响应</span>
<span class="sd">        ignore_connection_reset (bool): 将 ECONNREST 错误（目标连接复位）记录为 “info” 而非 failures</span>
<span class="sd">        ignore_connection_aborted (bool): 将ECONNABORTED错误记录为&quot;info&quot;而不是失败，默认为False。</span>
<span class="sd">        ignore_connection_issues_when_sending_fuzz_data (bool): 忽略发送模糊数据时的连接故障，默认为 True。这通常是一个有用的设置，因为目标一旦消息明显无效就可能会断开连接。</span>
<span class="sd">        ignore_connection_ssl_errors (bool): Log SSL related errors as &quot;info&quot; instead of failures. Default False.</span>
<span class="sd">        reuse_target_connection (bool): 如果为 True，则只使用一个目标连接（Target connection），而不是每个测试用例都重新连接。默认为 False。</span>
<span class="sd">        target (Target):        模糊（测试）会话的目标，必须完全初始化。默认为 None。</span>
<span class="sd">        db_filename (str):      存储测试结果和案例信息的 SQLite 数据库文件名。默认为 `./boofuzz-results/{uniq_timestamp}.db`。</span>
<span class="sd">        web_address:            Bofuzz 记录器对外的地址，默认为 `localhost`。</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">session_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">index_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">index_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sleep_time</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">restart_interval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">web_port</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_PORT</span><span class="p">,</span>
        <span class="n">keep_web_open</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">console_gui</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">crash_threshold_request</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">crash_threshold_element</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">restart_sleep_time</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">restart_callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">restart_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">restart_timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pre_send_callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">post_test_case_callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">post_start_target_callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fuzz_loggers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fuzz_db_keep_only_n_pass_cases</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">receive_data_after_each_request</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_data_received_each_request</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">receive_data_after_fuzz</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_connection_reset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_connection_aborted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_connection_issues_when_sending_fuzz_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ignore_connection_ssl_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">reuse_target_connection</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">web_address</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_ADDRESS</span><span class="p">,</span>
        <span class="n">db_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_reset</span> <span class="o">=</span> <span class="n">ignore_connection_reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_aborted</span> <span class="o">=</span> <span class="n">ignore_connection_aborted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_issues_when_sending_fuzz_data</span> <span class="o">=</span> <span class="n">ignore_connection_issues_when_sending_fuzz_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reuse_target_connection</span> <span class="o">=</span> <span class="n">reuse_target_connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_ssl_errors</span> <span class="o">=</span> <span class="n">ignore_connection_ssl_errors</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Session</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session_filename</span> <span class="o">=</span> <span class="n">session_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">index_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_end</span> <span class="o">=</span> <span class="n">index_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="n">sleep_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_interval</span> <span class="o">=</span> <span class="n">restart_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_port</span> <span class="o">=</span> <span class="n">web_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_web_open</span> <span class="o">=</span> <span class="n">keep_web_open</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">console_gui</span> <span class="o">=</span> <span class="n">console_gui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crash_threshold_node</span> <span class="o">=</span> <span class="n">crash_threshold_request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crash_threshold_element</span> <span class="o">=</span> <span class="n">crash_threshold_element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_sleep_time</span> <span class="o">=</span> <span class="n">restart_sleep_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_threshold</span> <span class="o">=</span> <span class="n">restart_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_timeout</span> <span class="o">=</span> <span class="n">restart_timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_address</span> <span class="o">=</span> <span class="n">web_address</span>
        <span class="k">if</span> <span class="n">fuzz_loggers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fuzz_loggers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">console_gui</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>
                <span class="n">fuzz_loggers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">fuzz_logger_curses</span><span class="o">.</span><span class="n">FuzzLoggerCurses</span><span class="p">(</span><span class="n">web_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">web_port</span><span class="p">,</span> <span class="n">web_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">web_address</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_keep_web_open</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fuzz_loggers</span> <span class="o">=</span> <span class="p">[</span><span class="n">fuzz_logger_text</span><span class="o">.</span><span class="n">FuzzLoggerText</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_run_id</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="c1"># 运行 id，形如 &#39;2023-08-17T02-47-17&#39;</span>
        <span class="k">if</span> <span class="n">db_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">mkdir_safe</span><span class="p">(</span><span class="n">db_filename</span><span class="p">,</span> <span class="n">file_included</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db_filename</span> <span class="o">=</span> <span class="n">db_filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">helpers</span><span class="o">.</span><span class="n">mkdir_safe</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">RESULTS_DIR</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">RESULTS_DIR</span><span class="p">,</span> <span class="s2">&quot;run-</span><span class="si">{0}</span><span class="s2">.db&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_db_logger</span> <span class="o">=</span> <span class="n">fuzz_logger_db</span><span class="o">.</span><span class="n">FuzzLoggerDb</span><span class="p">(</span>
            <span class="n">db_filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_filename</span><span class="p">,</span> <span class="n">num_log_cases</span><span class="o">=</span><span class="n">fuzz_db_keep_only_n_pass_cases</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_crash_filename</span> <span class="o">=</span> <span class="s2">&quot;boofuzz-crash-bin-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span> <span class="o">=</span> <span class="n">fuzz_logger</span><span class="o">.</span><span class="n">FuzzLogger</span><span class="p">(</span><span class="n">fuzz_loggers</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_logger</span><span class="p">]</span> <span class="o">+</span> <span class="n">fuzz_loggers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_received_each_request</span> <span class="o">=</span> <span class="n">check_data_received_each_request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_data_after_each_request</span> <span class="o">=</span> <span class="n">receive_data_after_each_request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_receive_data_after_fuzz</span> <span class="o">=</span> <span class="n">receive_data_after_fuzz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_node_after_current_test_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_element_after_current_test_case</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_pause_time</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">web_interface_thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_webapp_thread</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">web_port</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">web_address</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pre_send_callbacks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pre_send_methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pre_send_methods</span> <span class="o">=</span> <span class="n">pre_send_callbacks</span>

        <span class="k">if</span> <span class="n">post_test_case_callbacks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post_test_case_methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">post_test_case_methods</span> <span class="o">=</span> <span class="n">post_test_case_callbacks</span>

        <span class="k">if</span> <span class="n">post_start_target_callbacks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">post_start_target_methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">post_start_target_methods</span> <span class="o">=</span> <span class="n">post_start_target_callbacks</span>

        <span class="k">if</span> <span class="n">restart_callbacks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restart_methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restart_methods</span> <span class="o">=</span> <span class="n">restart_callbacks</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_callback_monitor</span> <span class="o">=</span> <span class="n">CallbackMonitor</span><span class="p">(</span>
            <span class="n">on_pre_send</span><span class="o">=</span><span class="n">pre_send_methods</span><span class="p">,</span>
            <span class="n">on_post_send</span><span class="o">=</span><span class="n">post_test_case_methods</span><span class="p">,</span>
            <span class="n">on_restart_target</span><span class="o">=</span><span class="n">restart_methods</span><span class="p">,</span>
            <span class="n">on_post_start_target</span><span class="o">=</span><span class="n">post_start_target_methods</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># total available protocol mutations (before combining multiple mutations)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># index within all mutations iterated through, including skipped mutations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># index within currently mutating element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cases_actually_fuzzed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Request object currently being fuzzed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_test_case_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_results</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># map of test case indices to list of crash synopsis strings (failed cases only)</span>
        <span class="c1"># map of test case indices to list of supplement captured data (all cases where data was captured)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_paused</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crashing_primitives</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_failure</span> <span class="o">=</span> <span class="n">event_hook</span><span class="o">.</span><span class="n">EventHook</span><span class="p">()</span>

        <span class="c1"># import settings if they exist.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_file</span><span class="p">()</span>

        <span class="c1"># create a root node. we do this because we need to start fuzzing from a single point and the user may want</span>
        <span class="c1"># to specify a number of initial requests.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">pgraph</span><span class="o">.</span><span class="n">Node</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;__ROOT_NODE__&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_recv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_send</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">apply_options</span><span class="p">(</span><span class="n">monitor</span><span class="p">):</span>
                <span class="n">monitor</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">crash_filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_crash_filename</span><span class="p">)</span>

                <span class="k">return</span>

            <span class="n">target</span><span class="o">.</span><span class="n">monitor_alive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">apply_options</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzRpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">raise</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">netmon_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;netmon_results is now part of monitor_results and thus can&#39;t be accessed directly.&quot;</span>
            <span class="s2">&quot; Please update your code.&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Session.add_node"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        将一个 pgraph 节点加入图中，当一个节点加入图中时，就会自动生成并分配一个 ID 给该节点。</span>

<span class="sd">        Args:</span>
<span class="sd">            node (pgraph.Node): 要加入会话图的节点</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">node</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Session.add_target"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.add_target">[docs]</a>    <span class="k">def</span> <span class="nf">add_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        将一个 target 加入到 session 中</span>
<span class="sd">        Add a target to the session. Multiple targets can be added for parallel fuzzing.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (Target): 要加入 session 的 Target 对象</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># pass specified target parameters to the PED-RPC server.</span>
        <span class="n">target</span><span class="o">.</span><span class="n">monitors_alive</span><span class="p">()</span>
        <span class="n">target</span><span class="o">.</span><span class="n">set_fuzz_data_logger</span><span class="p">(</span><span class="n">fuzz_data_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback_monitor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_callback_monitor</span><span class="p">)</span>

        <span class="c1"># add target to internal list.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></div>

<div class="viewcode-block" id="Session.connect"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a connection between the two requests (nodes) and register an optional callback to process in between</span>
<span class="sd">        transmissions of the source and destination request. The session class maintains a top level node that all</span>
<span class="sd">        initial requests must be connected to. Example::</span>

<span class="sd">            sess = sessions.session()</span>
<span class="sd">            sess.connect(sess.root, s_get(&quot;HTTP&quot;))</span>

<span class="sd">        If given only a single parameter, sess.connect() will default to attaching the supplied node to the root node.</span>
<span class="sd">        This is a convenient alias. The following line is identical to the second line from the above example::</span>

<span class="sd">            sess.connect(s_get(&quot;HTTP&quot;))</span>

<span class="sd">        Leverage callback methods to handle situations such as challenge response systems.</span>
<span class="sd">        A callback method must follow the message signature of :meth:`Session.example_test_case_callback`.</span>
<span class="sd">        Remember to include \\*\\*kwargs for forward-compatibility.</span>

<span class="sd">        Args:</span>
<span class="sd">            src (str or Request (pgrah.Node)): Source request name or request node</span>
<span class="sd">            dst (str or Request (pgrah.Node), optional): Destination request name or request node</span>
<span class="sd">            callback (def, optional): Callback function to pass received data to between node xmits. Default None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pgraph.Edge: The edge between the src and dst.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if only a source was provided, then make it the destination and set the source to the root node.</span>
        <span class="k">if</span> <span class="n">dst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">src</span>
            <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>

        <span class="c1"># if source or destination is a name, resolve the actual node.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

        <span class="c1"># if source or destination is not in the graph, add it.</span>
        <span class="k">if</span> <span class="n">src</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_node</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>

        <span class="c1"># create an edge between the two nodes and add it to the graph.</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">edge</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exec_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cases_actually_fuzzed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">runtime</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">runtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_pause_time</span>

<div class="viewcode-block" id="Session.export_file"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.export_file">[docs]</a>    <span class="k">def</span> <span class="nf">export_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dump various object values to disk.</span>

<span class="sd">        :see: import_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_filename</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;session_filename&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_filename</span><span class="p">,</span>
            <span class="s2">&quot;index_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span>
            <span class="s2">&quot;sleep_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">,</span>
            <span class="s2">&quot;restart_sleep_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_sleep_time</span><span class="p">,</span>
            <span class="s2">&quot;restart_interval&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_interval</span><span class="p">,</span>
            <span class="s2">&quot;web_port&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_port</span><span class="p">,</span>
            <span class="s2">&quot;web_address&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_address</span><span class="p">,</span>
            <span class="s2">&quot;crash_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crash_threshold_node</span><span class="p">,</span>
            <span class="s2">&quot;total_num_mutations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span><span class="p">,</span>
            <span class="s2">&quot;total_mutant_index&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span>
            <span class="s2">&quot;monitor_results&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_results</span><span class="p">,</span>
            <span class="s2">&quot;is_paused&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_paused</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_filename</span><span class="p">,</span> <span class="s2">&quot;wb+&quot;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_start_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">monitor</span><span class="o">.</span><span class="n">start_target</span><span class="p">():</span>
                <span class="n">started</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">started</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
                <span class="n">monitor</span><span class="o">.</span><span class="n">post_start_target</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">fuzz_data_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Session.import_file"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.import_file">[docs]</a>    <span class="k">def</span> <span class="nf">import_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load various object values from disk.</span>

<span class="sd">        :see: export_file()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="n">zlib</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">UnpicklingError</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># update the skip variable to pick up fuzzing from last test case.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_start</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;total_mutant_index&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_filename</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;session_filename&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sleep_time&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_sleep_time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;restart_sleep_time&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_interval</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;restart_interval&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_port</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;web_port&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_address</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;web_address&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crash_threshold_node</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;crash_threshold&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;total_num_mutations&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;total_mutant_index&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_results</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;monitor_results&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_paused</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;is_paused&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Session.num_mutations"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.num_mutations">[docs]</a>    <span class="k">def</span> <span class="nf">num_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of total mutations in the graph. The logic of this routine is identical to that of fuzz(). See fuzz()</span>
<span class="sd">        for inline comments. The member variable self.total_num_mutations is updated appropriately by this routine.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_depth (int): Maximum combinatorial depth used for fuzzing. num_mutations returns None if this value is</span>
<span class="sd">            None or greater than 1, as the number of mutations is typically very large when using combinatorial fuzzing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Total number of mutations in this session.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_depth</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_mutations_recursive</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_num_mutations_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">this_node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper for num_mutations.</span>

<span class="sd">        Args:</span>
<span class="sd">            this_node (request (node)): Current node that is being fuzzed. Default None.</span>
<span class="sd">            path (list): Nodes along the path to the current one being fuzzed. Default [].</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Total number of mutations in this session.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">this_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">this_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_from</span><span class="p">(</span><span class="n">this_node</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="n">next_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">+=</span> <span class="n">next_node</span><span class="o">.</span><span class="n">get_num_mutations</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">src</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_num_mutations_recursive</span><span class="p">(</span><span class="n">next_node</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

        <span class="c1"># finished with the last node on the path, pop it off the path stack.</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span>

    <span class="k">def</span> <span class="nf">_pause_if_pause_flag_is_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If that pause flag is raised, enter an endless loop until it is lowered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_paused</span><span class="p">:</span>
            <span class="n">pause_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_paused</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cumulative_pause_time</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">pause_start</span>

    <span class="k">def</span> <span class="nf">_check_for_passively_detected_failures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">failure_already_detected</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for and log passively detected failures. Return True if any found.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (Target): Target to be checked for failures.</span>
<span class="sd">            failure_already_detected (bool): If a failure was already detected.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if failures were found. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_crashed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Contact target monitors&quot;</span><span class="p">)</span>
            <span class="c1"># So, we need to run through the array two times. First, we check</span>
            <span class="c1"># if any of the monitors reported a failure and if so, we need to</span>
            <span class="c1"># gather a crash synopsis from them. We don&#39;t know whether</span>
            <span class="c1"># a monitor can provide a crash synopsis, but in any case, we&#39;ll</span>
            <span class="c1"># check. In the second run, we try to get crash synopsis from the</span>
            <span class="c1"># monitors that did not detect a crash as supplemental information.</span>
            <span class="n">finished_monitors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">monitor</span><span class="o">.</span><span class="n">post_send</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">fuzz_data_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="p">):</span>
                    <span class="n">has_crashed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_fail</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> detected crash on test case #</span><span class="si">{1}</span><span class="s2">: </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_crash_synopsis</span><span class="p">()</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">finished_monitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monitor</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_crashed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failure_already_detected</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_pass</span><span class="p">(</span><span class="s2">&quot;No crash detected.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">finished_monitors</span><span class="p">):</span>

                    <span class="n">synopsis</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_crash_synopsis</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">synopsis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_fail</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> provided additional information for crash on #</span><span class="si">{1}</span><span class="s2">: </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_crash_synopsis</span><span class="p">()</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="n">has_crashed</span>

    <span class="k">def</span> <span class="nf">_get_monitor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query monitors for any data they may want to add to this test case.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (Target): Monitor to query data from.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">retrieve_data</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> captured </span><span class="si">{1}</span><span class="s2"> bytes of additional data for test case #</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">monitor_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">monitor_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_process_failures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process any failures in self.crash_synopses.</span>

<span class="sd">        If self.crash_synopses contains any entries, perform these failure-related actions:</span>
<span class="sd">         - log failure summary if needed</span>
<span class="sd">         - save failures to self.monitor_results (for website)</span>
<span class="sd">         - exhaust node if crash threshold is reached</span>
<span class="sd">         - target restart</span>

<span class="sd">        Should be called after each fuzz test case.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (Target): Target to restart if failure occurred.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if any failures were found; False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">crash_synopses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">failed_test_cases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">most_recent_test_id</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crash_synopses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Failure summary&quot;</span><span class="p">)</span>

            <span class="c1"># retrieve the primitive that caused the crash and increment it&#39;s individual crash count.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crashing_primitives</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crashing_primitives</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crashing_primitives</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crashing_primitives</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># print crash synopsis</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crash_synopses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Prepend a header if &gt; 1 failure report, so that they are visible from the main web page</span>
                <span class="n">synopsis</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">{0}</span><span class="s2"> reports) </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">crash_synopses</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">crash_synopses</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">synopsis</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">crash_synopses</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">crash_synopses</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">synopsis</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">crashing_primitives</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crash_threshold_node</span>
            <span class="p">):</span>
                <span class="n">skipped</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">get_num_mutations</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_node_after_current_test_case</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span>
                    <span class="s2">&quot;Crash threshold reached for this request, exhausting </span><span class="si">{0}</span><span class="s2"> mutants.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">skipped</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">+=</span> <span class="n">skipped</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span> <span class="o">+=</span> <span class="n">skipped</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">crashing_primitives</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crash_threshold_element</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Group</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">Repeat</span>
                <span class="p">):</span>
                    <span class="n">skipped</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="o">.</span><span class="n">get_num_mutations</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_element_after_current_test_case</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span>
                        <span class="s2">&quot;Crash threshold reached for this element, exhausting </span><span class="si">{0}</span><span class="s2"> mutants.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">skipped</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">+=</span> <span class="n">skipped</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span> <span class="o">+=</span> <span class="n">skipped</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_restart_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Session.register_post_test_case_callback"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.register_post_test_case_callback">[docs]</a>    <span class="k">def</span> <span class="nf">register_post_test_case_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a post- test case method.</span>

<span class="sd">        The registered method will be called after each fuzz test case.</span>

<span class="sd">        Potential uses:</span>
<span class="sd">         * Closing down a connection.</span>
<span class="sd">         * Checking for expected responses.</span>

<span class="sd">        The order of callback events is as follows::</span>

<span class="sd">            pre_send() - req - callback ... req - callback - post-test-case-callback</span>

<span class="sd">        Args:</span>
<span class="sd">            method (function): A method with the same parameters as :func:`~Session.post_send`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callback_monitor</span><span class="o">.</span><span class="n">on_post_send</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">method</span><span class="p">)</span></div>

    <span class="c1"># noinspection PyUnusedLocal</span>
<div class="viewcode-block" id="Session.example_test_case_callback"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.example_test_case_callback">[docs]</a>    <span class="k">def</span> <span class="nf">example_test_case_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">fuzz_data_logger</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">test_case_context</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Example call signature for methods given to :func:`~Session.connect` or</span>
<span class="sd">        :func:`~Session.register_post_test_case_callback`</span>

<span class="sd">        Args:</span>
<span class="sd">            target (Target): Target with sock-like interface.</span>
<span class="sd">            fuzz_data_logger (ifuzz_logger.IFuzzLogger): Allows logging of test checks and passes/failures.</span>
<span class="sd">                Provided with a test case and test step already opened.</span>
<span class="sd">            session (Session): Session object calling post_send.</span>
<span class="sd">                Useful properties include last_send and last_recv.</span>
<span class="sd">            test_case_context (ProtocolSession): Context for test case-scoped data.</span>
<span class="sd">                :py:class:`ProtocolSession` :py:attr:`session_variables &lt;ProtocolSession.session_variables&gt;`</span>
<span class="sd">                values are generally set within a callback and referenced in elements via default values of type</span>
<span class="sd">                :py:class:`ProtocolSessionReference`.</span>
<span class="sd">            args: Implementations should include \\*args and \\**kwargs for forward-compatibility.</span>
<span class="sd">            kwargs: Implementations should include \\*args and \\**kwargs for forward-compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># default to doing nothing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;No post_send callback registered.&quot;</span><span class="p">)</span></div>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">_pre_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute custom methods to run prior to each fuzz request. The order of events is as follows::</span>

<span class="sd">            pre_send() - req - callback ... req - callback - post_send()</span>

<span class="sd">        When fuzzing RPC for example, register this method to establish the RPC bind.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (session.target): Target we are sending data to</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Monitor </span><span class="si">{}</span><span class="s2">.pre_send()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">)))</span>
                <span class="n">monitor</span><span class="o">.</span><span class="n">pre_send</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">fuzz_data_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span>
                    <span class="n">constants</span><span class="o">.</span><span class="n">ERR_CALLBACK_FUNC</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.pre_send()&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">)))</span>
                    <span class="o">+</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_restart_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restart the fuzz target. If a VMControl is available revert the snapshot, if a process monitor is available</span>
<span class="sd">        restart the target process. If custom restart methods are registered, execute them. Otherwise, do nothing.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (session.target): Target we are restarting</span>

<span class="sd">        Raises:</span>
<span class="sd">             exception.BoofuzzRestartFailedError: if restart fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: reuse_target_connection seems to be only handled when using</span>
        <span class="c1">#       a custom callback. wtf?</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Restarting target&quot;</span><span class="p">)</span>
        <span class="n">restarted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_failure</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_failure</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Calling registered on_failure method&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="p">(</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">)</span>
            <span class="n">restarted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># vm restarting is the preferred method so try that before monitors.</span>
        <span class="k">elif</span> <span class="n">target</span><span class="o">.</span><span class="n">vmcontrol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Restarting target virtual machine&quot;</span><span class="p">)</span>
            <span class="n">target</span><span class="o">.</span><span class="n">vmcontrol</span><span class="o">.</span><span class="n">restart_target</span><span class="p">()</span>
            <span class="n">restarted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># we always have at least one monitor; a Callback Monitor that handles all callbacks.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Restarting target process using </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">monitor</span><span class="o">.</span><span class="n">restart_target</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">fuzz_data_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="p">):</span>
                    <span class="c1"># TODO: doesn&#39;t this belong in the process monitor?</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Giving the process 3 seconds to settle in&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">restarted</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">restarted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">monitors</span><span class="p">:</span>
                <span class="n">monitor</span><span class="o">.</span><span class="n">post_start_target</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fuzz_data_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;No reset handler available... sleeping for </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restart_sleep_time</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restart_sleep_time</span><span class="p">)</span>

        <span class="c1"># pass specified target parameters to the PED-RPC server to re-establish connections.</span>
        <span class="n">target</span><span class="o">.</span><span class="n">monitors_alive</span><span class="p">()</span>

<div class="viewcode-block" id="Session.server_init"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.server_init">[docs]</a>    <span class="k">def</span> <span class="nf">server_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called by fuzz() to initialize variables, web interface, etc.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_interface_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="c1"># spawn the web interface.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">web_interface_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_callback_current_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">test_case_context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute callback preceding current node.</span>

<span class="sd">        Args:</span>
<span class="sd">            test_case_context (ProtocolSession): Context for test case-scoped data.</span>
<span class="sd">            node (pgraph.node.node (Node), optional): Current Request/Node</span>
<span class="sd">            edge (pgraph.edge.edge (pgraph.edge), optional): Edge along the current fuzz path from &quot;node&quot; to next node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bytes: Data rendered by current node if any; otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># if the edge has a callback, process it. the callback has the option to render the node, modify it and return.</span>
        <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Callback function &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">callback</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="p">,</span>
                <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="n">edge</span><span class="o">=</span><span class="n">edge</span><span class="p">,</span>
                <span class="n">test_case_context</span><span class="o">=</span><span class="n">test_case_context</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="Session.transmit_normal"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.transmit_normal">[docs]</a>    <span class="k">def</span> <span class="nf">transmit_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">callback_data</span><span class="p">,</span> <span class="n">mutation_context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render and transmit a non-fuzzed node, process callbacks accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            sock (Target, optional): Socket-like object on which to transmit node</span>
<span class="sd">            node (pgraph.node.node (Node), optional): Request/Node to transmit</span>
<span class="sd">            edge (pgraph.edge.edge (pgraph.edge), optional): Edge along the current fuzz path from &quot;node&quot; to next node.</span>
<span class="sd">            callback_data (bytes): Data from previous callback.</span>
<span class="sd">            mutation_context (MutationContext): active mutation context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callback_data</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">callback_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">mutation_context</span><span class="o">=</span><span class="n">mutation_context</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>  <span class="c1"># send</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_send</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionReset</span><span class="p">:</span>
            <span class="c1"># TODO: Switch _ignore_connection_reset for _ignore_transmission_error, or provide retry mechanism</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_reset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionAborted</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># TODO: Switch _ignore_connection_aborted for _ignore_transmission_error, or provide retry mechanism</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_ABORTED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">socket_errno</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errno</span><span class="p">,</span> <span class="n">socket_errmsg</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errmsg</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_aborted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzSSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_ssl_errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>  <span class="c1"># recv</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_data_after_each_request</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_recv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_received_each_request</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_check</span><span class="p">(</span><span class="s2">&quot;Verify some data was received from the target.&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_recv</span><span class="p">:</span>
                        <span class="c1"># Assume a crash?</span>
                        <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Nothing received from target.&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_pass</span><span class="p">(</span><span class="s2">&quot;Some data received from target.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionReset</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_received_each_request</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionAborted</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_ABORTED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">socket_errno</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errno</span><span class="p">,</span> <span class="n">socket_errmsg</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errmsg</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_received_each_request</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzSSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_ssl_errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="Session.transmit_fuzz"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.transmit_fuzz">[docs]</a>    <span class="k">def</span> <span class="nf">transmit_fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">callback_data</span><span class="p">,</span> <span class="n">mutation_context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render and transmit a fuzzed node, process callbacks accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            sock (Target, optional): Socket-like object on which to transmit node</span>
<span class="sd">            node (pgraph.node.node (Node), optional): Request/Node to transmit</span>
<span class="sd">            edge (pgraph.edge.edge (pgraph.edge), optional): Edge along the current fuzz path from &quot;node&quot; to next node.</span>
<span class="sd">            callback_data (bytes): Data from previous callback.</span>
<span class="sd">            mutation_context (MutationContext): Current mutation context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callback_data</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">callback_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">mutation_context</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>  <span class="c1"># send</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_send</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionReset</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_issues_when_sending_fuzz_data</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionAborted</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_ABORTED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">socket_errno</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errno</span><span class="p">,</span> <span class="n">socket_errmsg</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errmsg</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_issues_when_sending_fuzz_data</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzSSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_ssl_errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="n">received</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># recv</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_data_after_fuzz</span><span class="p">:</span>
                <span class="n">received</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionReset</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_received_each_request</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_RESET</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionAborted</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ERR_CONN_ABORTED</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">socket_errno</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errno</span><span class="p">,</span> <span class="n">socket_errmsg</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">socket_errmsg</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_data_received_each_request</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzSSLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_connection_ssl_errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_fail</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">BoofuzzFailure</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_recv</span> <span class="o">=</span> <span class="n">received</span></div>

<div class="viewcode-block" id="Session.build_webapp_thread"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.build_webapp_thread">[docs]</a>    <span class="k">def</span> <span class="nf">build_webapp_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_PORT</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_WEB_UI_ADDRESS</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Session 对象作为 flask 实例的 session 属性，之后利用 Tornado 根据 flask 实例创建 http 服务&quot;&quot;&quot;</span>
        <span class="n">app</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">http_server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">WSGIContainer</span><span class="p">(</span><span class="n">app</span><span class="p">))</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">http_server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="c1"># Only handle &quot;Address already in use&quot;</span>
                <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EADDRINUSE</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">port</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;Web interface can be found at http://</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
                <span class="k">break</span>
        <span class="n">flask_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="n">flask_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">flask_thread</span></div>

<div class="viewcode-block" id="Session.feature_check"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.feature_check">[docs]</a>    <span class="k">def</span> <span class="nf">feature_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check all messages/features.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_mutations</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_protocol_message_paths</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_message_check</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Session.fuzz"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.fuzz">[docs]</a>    <span class="k">def</span> <span class="nf">fuzz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fuzz the entire protocol tree.</span>

<span class="sd">        Iterates through and fuzzes all fuzz cases, skipping according to</span>
<span class="sd">        self.skip and restarting based on self.restart_interval.</span>

<span class="sd">        If you want the web server to be available, your program must persist</span>
<span class="sd">        after calling this method. helpers.pause_for_signal() is</span>
<span class="sd">        available to this end.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Pass in a Request name to fuzz only a single request message. Pass in a test case name to fuzz</span>
<span class="sd">                        only a single test case.</span>
<span class="sd">            max_depth (int): Maximum combinatorial depth; set to 1 for &quot;simple&quot; fuzzing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_mutations</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_fuzz_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_mutations_indefinitely</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_by_name</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Session.fuzz_by_name"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.fuzz_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">fuzz_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fuzz a particular test case or node by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Session.fuzz_by_name is deprecated in favor of Session.fuzz(name=name).&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">mutations</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">parse_test_case_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mutations</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_single_node_by_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">node_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_names_to_edges</span><span class="p">(</span><span class="n">node_names</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_main_fuzz_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_test_case_from_named_mutations</span><span class="p">(</span><span class="n">node_edges</span><span class="p">,</span> <span class="n">mutations</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_fuzz_single_node_by_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fuzz a particular node via the path in node_names.</span>

<span class="sd">        Args:</span>
<span class="sd">            node_names (list of str): List of node names leading to target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_names_to_edges</span><span class="p">(</span><span class="n">node_names</span><span class="o">=</span><span class="n">node_names</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span><span class="o">.</span><span class="n">get_num_mutations</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_main_fuzz_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_mutations_indefinitely</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">node_edges</span><span class="p">))</span>

<div class="viewcode-block" id="Session.fuzz_single_case"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.fuzz_single_case">[docs]</a>    <span class="k">def</span> <span class="nf">fuzz_single_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutant_index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deprecated: Fuzz a test case by mutant_index.</span>

<span class="sd">        Deprecation note: The new approach is to set Session&#39;s start and end indices to the same value.</span>

<span class="sd">        Args:</span>
<span class="sd">            mutant_index (int): Positive non-zero integer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            sex.SulleyRuntimeError: If any error is encountered while executing the test case.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Session.fuzz_single_case is deprecated in favor of Session&#39;s index_start and index_end constructor &quot;</span>
            <span class="s2">&quot;parameters.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_main_fuzz_loop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_single_case_by_index</span><span class="p">(</span><span class="n">mutant_index</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_message_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check messages for compatibility.</span>

<span class="sd">        Preconditions: `self.total_mutant_index` and `self.total_num_mutations` are set properly.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (list of Connection): Nodes (Requests) along the path to the target one.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_init</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_message</span><span class="p">(</span><span class="n">MutationContext</span><span class="p">(</span><span class="n">message_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mutations</span><span class="o">=</span><span class="p">{}))</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="c1"># TODO: should wait for the end of the ongoing test case, and stop gracefully netmon and procmon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;SIGINT received ... exiting&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzRestartFailedError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Restarting the target failed, exiting.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionFailedError</span><span class="p">:</span>
            <span class="c1"># exception should have already been handled but rethrown in order to escape test run</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unexpected exception! </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_main_fuzz_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fuzz_case_iterator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute main fuzz logic; takes an iterator of test cases.</span>

<span class="sd">        Preconditions: `self.total_mutant_index` and `self.total_num_mutations` are set properly.</span>

<span class="sd">        Args:</span>
<span class="sd">            fuzz_case_iterator (Iterable): An iterator that walks through fuzz cases and yields MutationContext objects.</span>
<span class="sd">                 See _iterate_single_node() for details.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_init</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reuse_target_connection</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cases_actually_fuzzed</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">mutation_context</span> <span class="ow">in</span> <span class="n">fuzz_case_iterator</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_start</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Check restart interval</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_cases_actually_fuzzed</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_interval</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cases_actually_fuzzed</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_interval</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;restart interval of </span><span class="si">%d</span><span class="s2"> reached&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_interval</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_restart_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_current_case</span><span class="p">(</span><span class="n">mutation_context</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">num_cases_actually_fuzzed</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_end</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reuse_target_connection</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_web_open</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Fuzzing session completed. Keeping webinterface up on </span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">web_address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">web_port</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Press ENTER to close webinterface&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="nb">input</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="c1"># TODO: should wait for the end of the ongoing test case, and stop gracefully netmon and procmon</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;SIGINT received ... exiting&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzRestartFailedError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Restarting the target failed, exiting.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionFailedError</span><span class="p">:</span>
            <span class="c1"># exception should have already been handled but rethrown in order to escape test run</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s2">&quot;Unexpected exception! </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">close_test</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_generate_single_case_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_case_index</span><span class="p">):</span>
        <span class="n">fuzz_index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_mutations_indefinitely</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fuzz_index</span> <span class="o">&gt;=</span> <span class="n">test_case_index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">m</span>
                <span class="k">break</span>
            <span class="n">fuzz_index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_generate_mutations_indefinitely</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield MutationContext with n mutations per message over all messages, with n increasing indefinitely.&quot;&quot;&quot;</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">max_depth</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">:</span>
            <span class="n">valid_case_found_at_this_depth</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_n_mutations</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
                <span class="n">valid_case_found_at_this_depth</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">yield</span> <span class="n">m</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_case_found_at_this_depth</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_generate_n_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield MutationContext with n mutations per message over all messages.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_protocol_message_paths</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_n_mutations_for_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">_generate_n_mutations_for_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield MutationContext with n mutations for a specific message.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (list of Connection): Nodes (Requests) along the path to the current one being fuzzed.</span>
<span class="sd">            depth (int): Yield sets of depth mutations.</span>

<span class="sd">        Yields:</span>
<span class="sd">            MutationContext: A MutationContext containing one mutation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">mutations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_n_mutations_for_path_recursive</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutations_contain_duplicate</span><span class="p">(</span><span class="n">mutations</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="n">MutationContext</span><span class="p">(</span><span class="n">message_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mutations</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="o">.</span><span class="n">qualified_name</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">mutations</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_generate_n_mutations_for_path_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">skip_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">skip_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skip_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">[]</span>
            <span class="k">return</span>
        <span class="n">new_skip</span> <span class="o">=</span> <span class="n">skip_elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">mutations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_mutations_for_request</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">skip_elements</span><span class="o">=</span><span class="n">skip_elements</span><span class="p">):</span>
            <span class="n">new_skip</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">qualified_name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mutations</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_n_mutations_for_path_recursive</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">skip_elements</span><span class="o">=</span><span class="n">new_skip</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">mutations</span> <span class="o">+</span> <span class="n">ms</span>

    <span class="k">def</span> <span class="nf">_iterate_protocol_message_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates over protocol and yields a path (list of Connection) leading to a given message).</span>

<span class="sd">        Args:</span>
<span class="sd">            path (list of Connection): Provide a specific path to yield only that specific path.</span>

<span class="sd">        Yields:</span>
<span class="sd">            list of Connection: List of edges along the path to the current one being fuzzed.</span>

<span class="sd">        Raises:</span>
<span class="sd">            exception.SulleyRuntimeError: If no requests defined or no targets specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we can&#39;t fuzz if we don&#39;t have at least one target and one request.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exception</span><span class="o">.</span><span class="n">SullyRuntimeError</span><span class="p">(</span><span class="s2">&quot;No targets specified in session&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">exception</span><span class="o">.</span><span class="n">SullyRuntimeError</span><span class="p">(</span><span class="s2">&quot;No requests specified in session&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_protocol_message_paths_recursive</span><span class="p">(</span><span class="n">this_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[]):</span>
                <span class="k">yield</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">_iterate_protocol_message_paths_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">this_node</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recursive helper for _iterate_protocol.</span>

<span class="sd">        Args:</span>
<span class="sd">            this_node (node.Node): Current node that is being fuzzed.</span>
<span class="sd">            path (list of Connection): List of edges along the path to the current one being fuzzed.</span>

<span class="sd">        Yields:</span>
<span class="sd">            list of Connection: List of edges along the path to the current one being fuzzed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># step through every edge from the current node.</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_from</span><span class="p">(</span><span class="n">this_node</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="c1"># keep track of the path as we fuzz through it, don&#39;t count the root node.</span>
            <span class="c1"># we keep track of edges as opposed to nodes because if there is more then one path through a set of</span>
            <span class="c1"># given nodes we don&#39;t want any ambiguity.</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>

            <span class="n">message_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message_path_to_str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;fuzzing: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>

            <span class="k">yield</span> <span class="n">path</span>

            <span class="c1"># recursively fuzz the remainder of the nodes in the session graph.</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_protocol_message_paths_recursive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">x</span>

        <span class="c1"># finished with the last node on the path, pop it off the path stack.</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_mutations_contain_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutations</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">qualified_name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mutations</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name1</span> <span class="ow">in</span> <span class="n">name2</span> <span class="ow">or</span> <span class="n">name2</span> <span class="ow">in</span> <span class="n">name1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_generate_mutations_for_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">skip_elements</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield each mutation for a specific message (the last message in path).</span>

<span class="sd">        Args:</span>
<span class="sd">            path (list of Connection): Nodes (Requests) along the path to the current one being fuzzed.</span>
<span class="sd">            path (iter of str): Qualified names of elements to skip while fuzzing.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Mutation: Mutation object describing a single mutation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">skip_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skip_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">mutations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">get_mutations</span><span class="p">(</span><span class="n">skip_elements</span><span class="o">=</span><span class="n">skip_elements</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">yield</span> <span class="n">mutations</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_node_after_current_test_case</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_node_after_current_test_case</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_element_after_current_test_case</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="o">.</span><span class="n">stop_mutations</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_current_element_after_current_test_case</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>

    <span class="k">def</span> <span class="nf">_generate_test_case_from_named_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mutation_names</span><span class="p">):</span>
        <span class="c1"># need a way to get the mutation value based on the mutation index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">mutations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mutation_name</span> <span class="ow">in</span> <span class="n">mutation_names</span><span class="p">:</span>
            <span class="n">qualified_name</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mutation_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">fuzzable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">qualified_name</span><span class="p">]</span>
            <span class="n">mutations</span> <span class="o">+=</span> <span class="nb">next</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">fuzzable</span><span class="o">.</span><span class="n">get_mutations</span><span class="p">(),</span> <span class="n">index</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">MutationContext</span><span class="p">(</span><span class="n">message_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mutations</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="o">.</span><span class="n">qualified_name</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">mutations</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_path_names_to_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_names</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a list of node names and return a list of edges describing that path.</span>

<span class="sd">        Args:</span>
<span class="sd">            node_names (list of str): List of node names describing a path.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of Connection: List of edges describing the path in node_names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="n">edge_path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="n">node_names</span><span class="p">:</span>
            <span class="n">next_node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges_from</span><span class="p">(</span><span class="n">cur_node</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">node_name</span><span class="p">:</span>
                    <span class="n">edge_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
                    <span class="n">next_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">next_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No edge found from </span><span class="si">{0}</span><span class="s2"> to </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cur_node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">node_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_node</span> <span class="o">=</span> <span class="n">next_node</span>
        <span class="k">return</span> <span class="n">edge_path</span>

    <span class="k">def</span> <span class="nf">_check_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutation_context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sends the current message without fuzzing.</span>

<span class="sd">        Current test case is controlled by fuzz_case_iterator().</span>

<span class="sd">        Args:</span>
<span class="sd">            mutation_context (MutationContext): Current mutation context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_if_pause_flag_is_set</span><span class="p">()</span>

        <span class="n">test_case_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_case_name_feature_check</span><span class="p">(</span><span class="n">mutation_context</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_case</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span> <span class="n">test_case_name</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">test_case_name</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span>
            <span class="n">num_mutations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span><span class="p">,</span>
            <span class="n">current_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span><span class="p">,</span>
            <span class="n">current_num_mutations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">get_num_mutations</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open_connection_keep_trying</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_send</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">prev_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">src</span><span class="p">]</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
                <span class="n">protocol_session</span> <span class="o">=</span> <span class="n">ProtocolSession</span><span class="p">(</span>
                    <span class="n">previous_message</span><span class="o">=</span><span class="n">prev_node</span><span class="p">,</span>
                    <span class="n">current_message</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">mutation_context</span><span class="o">.</span><span class="n">protocol_session</span> <span class="o">=</span> <span class="n">protocol_session</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Prep Node &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="n">callback_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback_current_node</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">test_case_context</span><span class="o">=</span><span class="n">protocol_session</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transmit_normal</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">callback_data</span><span class="o">=</span><span class="n">callback_data</span><span class="p">,</span> <span class="n">mutation_context</span><span class="o">=</span><span class="n">mutation_context</span><span class="p">)</span>

            <span class="n">prev_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">src</span><span class="p">]</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
            <span class="n">protocol_session</span> <span class="o">=</span> <span class="n">ProtocolSession</span><span class="p">(</span>
                <span class="n">previous_message</span><span class="o">=</span><span class="n">prev_node</span><span class="p">,</span>
                <span class="n">current_message</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">mutation_context</span><span class="o">.</span><span class="n">protocol_session</span> <span class="o">=</span> <span class="n">protocol_session</span>
            <span class="n">callback_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback_current_node</span><span class="p">(</span>
                <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">test_case_context</span><span class="o">=</span><span class="n">protocol_session</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Node Under Test &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transmit_normal</span><span class="p">(</span>
                <span class="n">target</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">,</span>
                <span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">callback_data</span><span class="o">=</span><span class="n">callback_data</span><span class="p">,</span>
                <span class="n">mutation_context</span><span class="o">=</span><span class="n">mutation_context</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_passively_detected_failures</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reuse_target_connection</span><span class="p">:</span>
                <span class="n">target</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Sleep between tests.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;sleeping for </span><span class="si">%f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_failures</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FAIL: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_case_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PASS: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_case_name</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_get_monitor_data</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">close_test_case</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_fuzz_current_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutation_context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fuzzes the current test case. Current test case is controlled by</span>
<span class="sd">        fuzz_case_iterator().</span>

<span class="sd">        Args:</span>
<span class="sd">            mutation_context (MutationContext): Current mutation context.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pause_if_pause_flag_is_set</span><span class="p">()</span>

        <span class="n">test_case_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_case_name</span><span class="p">(</span><span class="n">mutation_context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_test_case_name</span> <span class="o">=</span> <span class="n">test_case_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_case</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span> <span class="n">test_case_name</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">test_case_name</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span>
            <span class="n">num_mutations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span><span class="p">,</span>
            <span class="n">current_index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutant_index</span><span class="p">,</span>
            <span class="n">current_num_mutations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">get_num_mutations</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;Type: </span><span class="si">{0}</span><span class="s2">. Case </span><span class="si">{1}</span><span class="s2"> of </span><span class="si">{2}</span><span class="s2"> overall.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">total_mutant_index</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">total_num_mutations</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                <span class="s2">&quot;Type: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">mutant</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open_connection_keep_trying</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_send</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">prev_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">src</span><span class="p">]</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
                <span class="n">protocol_session</span> <span class="o">=</span> <span class="n">ProtocolSession</span><span class="p">(</span>
                    <span class="n">previous_message</span><span class="o">=</span><span class="n">prev_node</span><span class="p">,</span>
                    <span class="n">current_message</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">mutation_context</span><span class="o">.</span><span class="n">protocol_session</span> <span class="o">=</span> <span class="n">protocol_session</span>
                <span class="n">callback_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback_current_node</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">test_case_context</span><span class="o">=</span><span class="n">protocol_session</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Transmit Prep Node &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transmit_normal</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">callback_data</span><span class="o">=</span><span class="n">callback_data</span><span class="p">,</span> <span class="n">mutation_context</span><span class="o">=</span><span class="n">mutation_context</span><span class="p">)</span>

            <span class="n">prev_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">src</span><span class="p">]</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span>
            <span class="n">protocol_session</span> <span class="o">=</span> <span class="n">ProtocolSession</span><span class="p">(</span>
                <span class="n">previous_message</span><span class="o">=</span><span class="n">prev_node</span><span class="p">,</span>
                <span class="n">current_message</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">mutation_context</span><span class="o">.</span><span class="n">protocol_session</span> <span class="o">=</span> <span class="n">protocol_session</span>
            <span class="n">callback_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback_current_node</span><span class="p">(</span>
                <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">,</span> <span class="n">edge</span><span class="o">=</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">test_case_context</span><span class="o">=</span><span class="n">protocol_session</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Fuzzing Node &#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transmit_fuzz</span><span class="p">(</span>
                <span class="n">target</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fuzz_node</span><span class="p">,</span>
                <span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">callback_data</span><span class="o">=</span><span class="n">callback_data</span><span class="p">,</span>
                <span class="n">mutation_context</span><span class="o">=</span><span class="n">mutation_context</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_passively_detected_failures</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reuse_target_connection</span><span class="p">:</span>
                <span class="n">target</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">open_test_step</span><span class="p">(</span><span class="s2">&quot;Sleep between tests.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_time</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BoofuzzFailure</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_fail</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_passively_detected_failures</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">failure_already_detected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_failures</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">close_test_case</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">export_file</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_open_connection_keep_trying</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open connection and if it fails, keep retrying.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (Target): Target to open.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reuse_target_connection</span><span class="p">:</span>
            <span class="n">out_of_available_sockets_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">unable_to_connect_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">initial_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">target</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
                    <span class="k">break</span>  <span class="c1"># break if no exception</span>
                <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzTargetConnectionFailedError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_threshold</span> <span class="ow">and</span> <span class="n">unable_to_connect_count</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_threshold</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                            <span class="s2">&quot;Unable to reconnect to target: Reached threshold of </span><span class="si">{0}</span><span class="s2"> retries. Ending fuzzing.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">restart_threshold</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">raise</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_timeout</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">initial_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_timeout</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span>
                            <span class="s2">&quot;Unable to reconnect to target: Reached restart timeout of </span><span class="si">{0}</span><span class="s2">s. Ending fuzzing.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">restart_timeout</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">raise</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">WARN_CONN_FAILED_TERMINAL</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_restart_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                        <span class="n">unable_to_connect_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzOutOfAvailableSockets</span><span class="p">:</span>
                    <span class="n">out_of_available_sockets_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">out_of_available_sockets_count</span> <span class="o">==</span> <span class="mi">50</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">exception</span><span class="o">.</span><span class="n">BoofuzzError</span><span class="p">(</span><span class="s2">&quot;There are no available sockets. Ending fuzzing.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;There are no available sockets. Waiting for another 5 seconds.&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fuzz_data_logger</span><span class="o">.</span><span class="n">log_info</span><span class="p">(</span><span class="s2">&quot;sleeping for </span><span class="si">%f</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="n">seconds</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_test_case_name_feature_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutation_context</span><span class="p">):</span>
        <span class="n">message_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message_path_to_str</span><span class="p">(</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;FEATURE-CHECK-&gt;</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_test_case_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutation_context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get long test case name.</span>

<span class="sd">        Args:</span>
<span class="sd">            mutation_context (MutationContext): MutationContext to get name from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Long formatted test case name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message_path_to_str</span><span class="p">(</span><span class="n">mutation_context</span><span class="o">.</span><span class="n">message_path</span><span class="p">)</span>
        <span class="n">mutation_names</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">:</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qualified_name</span><span class="p">,</span> <span class="n">mutation</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">qualified_name</span><span class="p">,</span> <span class="n">mutation</span> <span class="ow">in</span> <span class="n">mutation_context</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">:[</span><span class="si">{1}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message_path</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mutation_names</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_message_path_to_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_path</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">dst</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">message_path</span><span class="p">])</span>

<div class="viewcode-block" id="Session.test_case_data"><a class="viewcode-back" href="../../source/Session.html#boofuzz.Session.test_case_data">[docs]</a>    <span class="k">def</span> <span class="nf">test_case_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return test case data object (for use by web server)</span>

<span class="sd">        Args:</span>
<span class="sd">            index (int): Test case index</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataTestCase: Test case data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_logger</span><span class="o">.</span><span class="n">get_test_case_data</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Joshua Pereyda.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>